//----------------------------------------------------
//		Whisper is NPC:gmreward
//		NPC by Robert (rocky6861)
//---------------------------------------------------
-	script	gmreward	-1,{
OnWhisperGlobal:
	if(getgmlevel() == 99)	goto A_admin;
	if(getgmlevel() >= 30)	goto A_talk;		// Obvious, checks GM lvl of char looking at NPC
	if(getgmlevel() <= 59)	end;


A_talk:
	query_sql ("SELECT DISTINCT GM_Points,GM_Account FROM gmpoints WHERE GM_Account = '"+getcharid(3)+"'"), .@GMpoints, .@GMaccount;// gets gm points and gm account info & stores into variables
	mes .npcname$;
	mes "Hello "+ strcharinfo(0) +",";
	mes "You currently have "+ .@GMpoints +" left.";
	mes "Would you like to spend your points now?";
	next;
	switch(select("Yes:No")){
	case 1:
		setarray $menu$[0],"INRO Coupon";
		setarray $itemcosts[0],10;
		setarray $itemID[0],7199;

// The Above is the item, price, and item ID arrays. Add, change, delete up there. AND it is easiest to add to the end of each array than add to the middle.
// But remember to remove, or add case #: if you remove or add items.

		set @menu$,"";
		for (set @i,0; @i < getarraysize($menu$)-1; set @i,@i+1){ //builds the menu dynamically.
		set @menu$,@menu$ + $menu$[@i]+":";
		}
		switch(select(@menu$)){
		case 1:
				input .@num;
				set .@price, $itemcosts[0]; // the price of the item
				set .@cost, .@num*.@price;  // the total cost of all the items
				mes "You want "+.@num+" "+$menu$[0]+"?";
				mes "It will cost you "+.@cost+".";
				if(select("Yes:No") == 2) goto A_talk;
				if( .@GMpoints < .@cost) goto A_notenough; // checks if there are enough gm points to purchase items.
				getitem 	$itemID[0], .@num; 	// player recieves the items
				set .@GMpoints, .@GMpoints - .@cost; //gm points have total cost deducted
				query_sql ("UPDATE gmpoints SET GM_Points = '"+.@GMpoints+"' WHERE GM_Account = '"+.@GMaccount+"'"); //updates gm points total
				next;
				goto A_talk; //goes back to the begining.
				end;
		// if you need to add cases then add them below this line
		}
	case 2:
		mes "See you later then!";
		close;
	}

A_notenough:
	mes "You dont have enough points";
	next;
	goto A_talk;
	end;

A_admin: // special menu for Admin's only.
	mes .npcname$;
	mes "Hello Mr. "+strcharinfo(0);
	mes "What can I help you with today?";
	next;
	menu "Add Points",A_addpoints,"View Points",A_viewpoints,"Spend Points",A_talk;

A_addpoints:
		mes .npcname$;
		mes "What is the name of the GM I should add the funds to?";// needs to be exact player name. ie. "GM Shinda" not "Shinda" or "Gm shinda"
		input .@GMname$;
		next;
		mes .name$;
		mes "Now, what is the amount of points I should add?"; // how many points to add.
		input .@GMpointsadded;
		next;
		mes .name$;
		mes "Please check if the following information is right:";
		mes "GM Name: "+.@GMname$+"";
		mes "Cash Points to add: "+.@GMpointsadded+""; // Double check the information. if wrong, will restart the add points section.
		next;
		if (select("Yes:No") == 2) goto A_admin;
		mes .name$;
		mes "I added "+.@GMpointsadded+" to "+.@GMname$+"'s points."; //says who is getting more points.
		query_sql ("SELECT DISTINCT account_id FROM `char` where name = '"+.@GMname$+"'"), .@GMaccount; // gets the recieving GM's account ID
		query_sql("SELECT count(GM_Account) FROM gmpoints WHERE GM_Account = '"+.@GMaccount+"'"), .@nb; //determines if there is a record of this GM or if its new.
		if(.@nb == 0) query_sql ("INSERT INTO gmpoints(GM_Account,GM_Name,GM_Points) VALUES ('"+.@GMaccount+"','"+.@GMname$+"','0')"); // If its new GM it makes a new row, otherwise it just keeps going.
		query_sql ("SELECT DISTINCT GM_Points FROM gmpoints WHERE GM_Account = '"+.@GMaccount+"'"), .@gmp; // selects the current gm points of recieving GM.
		set .@gmp, .@gmp + .@GMpointsadded; // adds the amount to be added to the old amount.
		query_sql ("UPDATE gmpoints SET GM_Points = '"+.@gmp+"' WHERE GM_Account = '"+.@GMaccount+"'"); //updates the gm points for the recieving GM
		mes .@GMname$+" now has "+.@gmp+" points"; //shows the final result with updated total gm points
		next;
		goto A_admin;// goes back to admin menu
		end;


A_viewpoints:
	mes .npcname$;
	query_sql ("SELECT count(GM_Name) FROM gmpoints"),.@numAcc; // this is for determining the length of the list
	mes "Current Points are as follows";
	query_sql("select GM_Account,GM_Name,GM_Points from gmpoints", .@gmaccount, .@gmname$, .@gmpoints);// gathers all information of gm accounts in the DB
	for(set .@PT, 0; .@PT < .@numAcc; set .@PT, .@PT +1){
		mes ""+.@gmname$[.@PT]+" at "+.@gmpoints[.@PT]+"";	//prints out each GM name and current total gm points
		sleep2 10;
		}
	next;
	menu "Add Points",A_addpoints,"Spend Points",A_talk,"Nothing more",-;
	close;

}
